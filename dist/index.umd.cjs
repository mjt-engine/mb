(function(N,re){typeof exports=="object"&&typeof module<"u"?re(exports):typeof define=="function"&&define.amd?define(["exports"],re):(N=typeof globalThis<"u"?globalThis:N||self,re(N.Module={}))})(this,function(N){"use strict";const re=e=>{const t=e.split("."),r=t.shift(),n=t.join(".");return{root:r,segments:t,subpath:n}},Ce=e=>"value"in e&&e.value!==void 0,Ne=e=>"error"in e&&e.error!==void 0,Mt=e=>Ce(e)||Ne(e),qe=e=>{const t=e;return typeof t=="object"&&t!==null&&"data"in t},$e=e=>{const t=e;return qe(e)&&t.meta?.hasError||!1},Fe={"SHA-256":32,"SHA-512":64},Se=["SHA-256","SHA-512"];function be(e){if(typeof e=="string")return e;const t=e();return typeof t=="string"?t:(console.error("ASSERTION FAIL VALUE",t),"Assertion Failed")}function ue(e,t="Assertion failed"){if(!e)throw new Error(be(t))}const ze=(e,t,r=()=>(console.error(e,t),`Assertion failed: ${JSON.stringify(e)} is not equal to ${JSON.stringify(t)}`))=>{throw new Error("assertEqualElements: Bitrotted")},Pt=(e,t,r=()=>(console.error(e,t),`Assertion failed: ${JSON.stringify(e)} is not equal to ${JSON.stringify(t)}`))=>Array.isArray(e)&&Array.isArray(t)?ze(e,t,r):ue(e===t,r),_t=(e,t,r=()=>(console.error(e,t),`Assertion failed: ${JSON.stringify(e)} is equal to ${JSON.stringify(t)}`))=>ue(e!==t,r);function Rt(e,t,r="Assertion failed: Required value is not of correct type"){if(!t(e))throw new Error(be(r));return e}function Lt(e,t="Assertion failed: Reached what should be an unreachable section of code"){throw new Error(be(t))}function Dt(e){return e!=null&&!Number.isNaN(e)}function Vt(e,t="Assertion failed: Required value not defined"){return ue(Dt(e),t),e}const W={assert:ue,assertUnreachable:Lt,assertValue:Vt,assertEqual:Pt,assertNotEqual:_t,assertEqualElements:ze,assertType:Rt},me=e=>{const t=e.flatMap(r=>typeof r=="number"?[r]:JSON.stringify(r).split("").map(n=>n.codePointAt(0)));return new Float64Array(t.length).map((r,n)=>t[n])},ee=async e=>e instanceof ArrayBuffer?e:e instanceof Blob?e.arrayBuffer():typeof e=="string"?new TextEncoder().encode(e):ArrayBuffer.isView(e)?e.buffer:Array.isArray(e)?me(e):new ArrayBuffer(0),ce=async({bytes:e,algorithm:t="SHA-512"})=>{const r=await ee(e);return crypto.subtle.digest(t,r)},Je=async(e,t=16)=>{const r=await ee(e);return[...new Uint8Array(r)].map(n=>n.toString(t).padStart(2,"0")).join("")},le=async({bytes:e,algorithm:t="SHA-512",radix:r=16})=>{const n=await ce({bytes:e,algorithm:t}),i=await Je(n,r);return`${t}:${i}`},jt=({id:e})=>{const t=e.split(":");W.assert(t.length===2);const[r,n]=t,i=atob(n),u=new Uint8Array(i.length);return i.split("").map(c=>c.charCodeAt(0)).forEach((c,h)=>{u[h]=c}),u},He=async e=>{if(typeof e=="string")return e;const t=await ee(e);return new TextDecoder().decode(t)},ne=[];ne.push(async()=>{const e="test",t=await ee(e),r=await He(t);return W.assertEqual(e,r)}),ne.push(async()=>Se.map(async e=>{const t=await ce({bytes:"test",algorithm:e});return W.assertEqual(t.byteLength,Fe[e])})),ne.push(async()=>{{const e=await le({bytes:"test",algorithm:"SHA-256"});W.assertEqual(e,"SHA-256:n4bQgYhMfWWaL+qgxVrQFaO/TxsrC4Is0V1sFbDwCgg=")}{const e=await le({bytes:"test",algorithm:"SHA-512"});W.assertEqual(e,"SHA-512:7iaw3Ur350mqGo7jwQrpkj9hiYB3Lkc/iBml1JQODbJ6wYX4oOHV+E+IvIh/1nsUNzLDBMxfqa2Ob1f1ACio/w==")}}),ne.push(async()=>Se.map(async e=>{const t="test",r=await le({bytes:t,algorithm:e}),n=new Uint8Array(await ce({bytes:t,algorithm:e})),i=jt({id:r});return W.assertEqualElements(i,n)}));const Ct=async()=>{if((await Promise.all(ne.map(async t=>{try{return await t(),!0}catch(r){return console.error(r),!1}}))).find(t=>t===!1))throw new Error("TESTS FAILED");return console.log("TESTS PASS"),!0};function Ae(e){const t=new Uint8Array(e.slice(0));let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return btoa(r)}const Nt=e=>{const t=new Uint8Array(e),r=[];for(let n=0;n<t.length;++n)r.push(t[n].toString(16).padStart(2,"0"));return r.join("")},qt=e=>new TextDecoder().decode(new Uint8Array(e)),$t=(e,t)=>e.slice(0,e.size,t),Ft=e=>{const t=globalThis.atob(e),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer},zt=e=>{if(!e)return;const t=e.split(","),n=(t[0].match(/:(.*?);/)??[])[1],i=atob(t[1]);let u=i.length;const c=new Uint8Array(u);for(;u--;)c[u]=i.charCodeAt(u);return new Blob([c],{type:n})},Be=e=>e instanceof ArrayBuffer?e:typeof e=="string"?new TextEncoder().encode(e):ArrayBuffer.isView(e)?e.buffer:Array.isArray(e)?me(e):new ArrayBuffer(0),Jt=async(e,t)=>{const r=Be(e);return crypto.subtle.digest(t,r)},Ee=e=>{const t=e;return!!(t instanceof ArrayBuffer||typeof t=="string"||ArrayBuffer.isView(t)||Array.isArray(t))},Ht=e=>e instanceof Blob?!0:Ee(e),Qt=e=>{if(typeof e=="string")return e.length;if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))return e.byteLength};var Ue;try{Ue=new TextDecoder}catch{}var x,z,s=0,I={},E,Y,$=0,J=0,D,Q,q=[],A,Qe={useRecords:!1,mapsAsObjects:!0};class Ye{}const ve=new Ye;ve.name="MessagePack 0xC1";var v=!1,Ge=2,Yt;try{new Function("")}catch{Ge=1/0}class ie{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,r){if(x)return ot(()=>(Me(),this?this.unpack(t,r):ie.prototype.unpack.call(Qe,t,r)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof r=="object"?(z=r.end||t.length,s=r.start||0):(s=0,z=r>-1?r:t.length),J=0,Y=null,D=null,x=t;try{A=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw x=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ie){if(I=this,this.structures)return E=this.structures,de(r);(!E||E.length>0)&&(E=[])}else I=Qe,(!E||E.length>0)&&(E=[]);return de(r)}unpackMultiple(t,r){let n,i=0;try{v=!0;let u=t.length,c=this?this.unpack(t,u):xe.unpack(t,u);if(r){if(r(c,i,s)===!1)return;for(;s<u;)if(i=s,r(de(),i,s)===!1)return}else{for(n=[c];s<u;)i=s,n.push(de());return n}}catch(u){throw u.lastPosition=i,u.values=n,u}finally{v=!1,Me()}}_mergeStructures(t,r){t=t||[],Object.isFrozen(t)&&(t=t.map(n=>n.slice(0)));for(let n=0,i=t.length;n<i;n++){let u=t[n];u&&(u.isShared=!0,n>=32&&(u.highByte=n-32>>5))}t.sharedLength=t.length;for(let n in r||[])if(n>=0){let i=t[n],u=r[n];u&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[n]=i),t[n]=u)}return this.structures=t}decode(t,r){return this.unpack(t,r)}}function de(e){try{if(!I.trusted&&!v){let r=E.sharedLength||0;r<E.length&&(E.length=r)}let t;if(I.randomAccessStructure&&x[s]<64&&x[s]>=32&&Yt||(t=R()),D&&(s=D.postBundlePosition,D=null),v&&(E.restoreStructures=null),s==z)E&&E.restoreStructures&&Ke(),E=null,x=null,Q&&(Q=null);else{if(s>z)throw new Error("Unexpected end of MessagePack data");if(!v){let r;try{r=JSON.stringify(t,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return t}catch(t){throw E&&E.restoreStructures&&Ke(),Me(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||s>z)&&(t.incomplete=!0),t}}function Ke(){for(let e in E.restoreStructures)E[e]=E.restoreStructures[e];E.restoreStructures=null}function R(){let e=x[s++];if(e<160)if(e<128){if(e<64)return e;{let t=E[e&63]||I.getStructures&&Xe()[e&63];return t?(t.read||(t.read=Te(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,I.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=it();n==="__proto__"&&(n="__proto_"),t[n]=R()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(R(),R());return t}else{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=R();return I.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(J>=s)return Y.slice(s-$,(s+=t)-$);if(J==0&&z<140){let r=t<16?Oe(t):tt(t);if(r!=null)return r}return ke(t)}else{let t;switch(e){case 192:return null;case 193:return D?(t=R(),t>0?D[1].slice(D.position1,D.position1+=t):D[0].slice(D.position0,D.position0-=t)):ve;case 194:return!1;case 195:return!0;case 196:if(t=x[s++],t===void 0)throw new Error("Unexpected end of buffer");return Ie(t);case 197:return t=A.getUint16(s),s+=2,Ie(t);case 198:return t=A.getUint32(s),s+=4,Ie(t);case 199:return X(x[s++]);case 200:return t=A.getUint16(s),s+=2,X(t);case 201:return t=A.getUint32(s),s+=4,X(t);case 202:if(t=A.getFloat32(s),I.useFloat32>2){let r=Pe[(x[s]&127)<<1|x[s+1]>>7];return s+=4,(r*t+(t>0?.5:-.5)>>0)/r}return s+=4,t;case 203:return t=A.getFloat64(s),s+=8,t;case 204:return x[s++];case 205:return t=A.getUint16(s),s+=2,t;case 206:return t=A.getUint32(s),s+=4,t;case 207:return I.int64AsType==="number"?(t=A.getUint32(s)*4294967296,t+=A.getUint32(s+4)):I.int64AsType==="string"?t=A.getBigUint64(s).toString():I.int64AsType==="auto"?(t=A.getBigUint64(s),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=A.getBigUint64(s),s+=8,t;case 208:return A.getInt8(s++);case 209:return t=A.getInt16(s),s+=2,t;case 210:return t=A.getInt32(s),s+=4,t;case 211:return I.int64AsType==="number"?(t=A.getInt32(s)*4294967296,t+=A.getUint32(s+4)):I.int64AsType==="string"?t=A.getBigInt64(s).toString():I.int64AsType==="auto"?(t=A.getBigInt64(s),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=A.getBigInt64(s),s+=8,t;case 212:if(t=x[s++],t==114)return ft(x[s++]&63);{let r=q[t];if(r)return r.read?(s++,r.read(R())):r.noBuffer?(s++,r()):r(x.subarray(s,++s));throw new Error("Unknown extension "+t)}case 213:return t=x[s],t==114?(s++,ft(x[s++]&63,x[s++])):X(2);case 214:return X(4);case 215:return X(8);case 216:return X(16);case 217:return t=x[s++],J>=s?Y.slice(s-$,(s+=t)-$):Gt(t);case 218:return t=A.getUint16(s),s+=2,J>=s?Y.slice(s-$,(s+=t)-$):Kt(t);case 219:return t=A.getUint32(s),s+=4,J>=s?Y.slice(s-$,(s+=t)-$):Zt(t);case 220:return t=A.getUint16(s),s+=2,We(t);case 221:return t=A.getUint32(s),s+=4,We(t);case 222:return t=A.getUint16(s),s+=2,et(t);case 223:return t=A.getUint32(s),s+=4,et(t);default:if(e>=224)return e-256;if(e===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+e)}}}const vt=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Te(e,t){function r(){if(r.count++>Ge){let i=e.read=new Function("r","return function(){return "+(I.freezeData?"Object.freeze":"")+"({"+e.map(u=>u==="__proto__"?"__proto_:r()":vt.test(u)?u+":r()":"["+JSON.stringify(u)+"]:r()").join(",")+"})}")(R);return e.highByte===0&&(e.read=Ze(t,e.read)),i()}let n={};for(let i=0,u=e.length;i<u;i++){let c=e[i];c==="__proto__"&&(c="__proto_"),n[c]=R()}return I.freezeData?Object.freeze(n):n}return r.count=0,e.highByte===0?Ze(t,r):r}const Ze=(e,t)=>function(){let r=x[s++];if(r===0)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),i=E[n]||Xe()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=Te(i,e)),i.read()};function Xe(){let e=ot(()=>(x=null,I.getStructures()));return E=I._mergeStructures(e,E)}var ke=se,Gt=se,Kt=se,Zt=se;function se(e){let t;if(e<16&&(t=Oe(e)))return t;if(e>64&&Ue)return Ue.decode(x.subarray(s,s+=e));const r=s+e,n=[];for(t="";s<r;){const i=x[s++];if((i&128)===0)n.push(i);else if((i&224)===192){const u=x[s++]&63;n.push((i&31)<<6|u)}else if((i&240)===224){const u=x[s++]&63,c=x[s++]&63;n.push((i&31)<<12|u<<6|c)}else if((i&248)===240){const u=x[s++]&63,c=x[s++]&63,h=x[s++]&63;let w=(i&7)<<18|u<<12|c<<6|h;w>65535&&(w-=65536,n.push(w>>>10&1023|55296),w=56320|w&1023),n.push(w)}else n.push(i);n.length>=4096&&(t+=V.apply(String,n),n.length=0)}return n.length>0&&(t+=V.apply(String,n)),t}function We(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=R();return I.freezeData?Object.freeze(t):t}function et(e){if(I.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=it();n==="__proto__"&&(n="__proto_"),t[n]=R()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(R(),R());return t}}var V=String.fromCharCode;function tt(e){let t=s,r=new Array(e);for(let n=0;n<e;n++){const i=x[s++];if((i&128)>0){s=t;return}r[n]=i}return V.apply(String,r)}function Oe(e){if(e<4)if(e<2){if(e===0)return"";{let t=x[s++];if((t&128)>1){s-=1;return}return V(t)}}else{let t=x[s++],r=x[s++];if((t&128)>0||(r&128)>0){s-=2;return}if(e<3)return V(t,r);let n=x[s++];if((n&128)>0){s-=3;return}return V(t,r,n)}else{let t=x[s++],r=x[s++],n=x[s++],i=x[s++];if((t&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){s-=4;return}if(e<6){if(e===4)return V(t,r,n,i);{let u=x[s++];if((u&128)>0){s-=5;return}return V(t,r,n,i,u)}}else if(e<8){let u=x[s++],c=x[s++];if((u&128)>0||(c&128)>0){s-=6;return}if(e<7)return V(t,r,n,i,u,c);let h=x[s++];if((h&128)>0){s-=7;return}return V(t,r,n,i,u,c,h)}else{let u=x[s++],c=x[s++],h=x[s++],w=x[s++];if((u&128)>0||(c&128)>0||(h&128)>0||(w&128)>0){s-=8;return}if(e<10){if(e===8)return V(t,r,n,i,u,c,h,w);{let B=x[s++];if((B&128)>0){s-=9;return}return V(t,r,n,i,u,c,h,w,B)}}else if(e<12){let B=x[s++],p=x[s++];if((B&128)>0||(p&128)>0){s-=10;return}if(e<11)return V(t,r,n,i,u,c,h,w,B,p);let b=x[s++];if((b&128)>0){s-=11;return}return V(t,r,n,i,u,c,h,w,B,p,b)}else{let B=x[s++],p=x[s++],b=x[s++],M=x[s++];if((B&128)>0||(p&128)>0||(b&128)>0||(M&128)>0){s-=12;return}if(e<14){if(e===12)return V(t,r,n,i,u,c,h,w,B,p,b,M);{let L=x[s++];if((L&128)>0){s-=13;return}return V(t,r,n,i,u,c,h,w,B,p,b,M,L)}}else{let L=x[s++],F=x[s++];if((L&128)>0||(F&128)>0){s-=14;return}if(e<15)return V(t,r,n,i,u,c,h,w,B,p,b,M,L,F);let j=x[s++];if((j&128)>0){s-=15;return}return V(t,r,n,i,u,c,h,w,B,p,b,M,L,F,j)}}}}}function rt(){let e=x[s++],t;if(e<192)t=e-160;else switch(e){case 217:t=x[s++];break;case 218:t=A.getUint16(s),s+=2;break;case 219:t=A.getUint32(s),s+=4;break;default:throw new Error("Expected string")}return se(t)}function Ie(e){return I.copyBuffers?Uint8Array.prototype.slice.call(x,s,s+=e):x.subarray(s,s+=e)}function X(e){let t=x[s++];if(q[t]){let r;return q[t](x.subarray(s,r=s+=e),n=>{s=n;try{return R()}finally{s=r}})}else throw new Error("Unknown extension type "+t)}var nt=new Array(4096);function it(){let e=x[s++];if(e>=160&&e<192){if(e=e-160,J>=s)return Y.slice(s-$,(s+=e)-$);if(!(J==0&&z<180))return ke(e)}else return s--,st(R());let t=(e<<5^(e>1?A.getUint16(s):e>0?x[s]:0))&4095,r=nt[t],n=s,i=s+e-3,u,c=0;if(r&&r.bytes==e){for(;n<i;){if(u=A.getUint32(n),u!=r[c++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(u=x[n++],u!=r[c++]){n=1879048192;break}if(n===i)return s=n,r.string;i-=3,n=s}for(r=[],nt[t]=r,r.bytes=e;n<i;)u=A.getUint32(n),r.push(u),n+=4;for(i+=3;n<i;)u=x[n++],r.push(u);let h=e<16?Oe(e):tt(e);return h!=null?r.string=h:r.string=ke(e)}function st(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const ft=(e,t)=>{let r=R().map(st),n=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let i=E[e];return i&&(i.isShared||v)&&((E.restoreStructures||(E.restoreStructures=[]))[e]=i),E[e]=r,r.read=Te(r,n),r.read()};q[0]=()=>{},q[0].noBuffer=!0,q[66]=e=>{let t=e.length,r=BigInt(e[0]&128?e[0]-256:e[0]);for(let n=1;n<t;n++)r<<=BigInt(8),r+=BigInt(e[n]);return r};let Xt={Error,TypeError,ReferenceError};q[101]=()=>{let e=R();return(Xt[e[0]]||Error)(e[1],{cause:e[2]})},q[105]=e=>{if(I.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=A.getUint32(s-4);Q||(Q=new Map);let r=x[s],n;r>=144&&r<160||r==220||r==221?n=[]:n={};let i={target:n};Q.set(t,i);let u=R();return i.used?Object.assign(n,u):(i.target=u,u)},q[112]=e=>{if(I.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=A.getUint32(s-4),r=Q.get(t);return r.used=!0,r.target},q[115]=()=>new Set(R());const at=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let Wt=typeof globalThis=="object"?globalThis:window;q[116]=e=>{let t=e[0],r=at[t];if(!r){if(t===16){let n=new ArrayBuffer(e.length-1);return new Uint8Array(n).set(e.subarray(1)),n}throw new Error("Could not find typed array for code "+t)}return new Wt[r](Uint8Array.prototype.slice.call(e,1).buffer)},q[120]=()=>{let e=R();return new RegExp(e[0],e[1])};const er=[];q[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=s;return s+=t-e.length,D=er,D=[rt(),rt()],D.position0=0,D.position1=0,D.postBundlePosition=s,s=r,R()},q[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function ot(e){let t=z,r=s,n=$,i=J,u=Y,c=Q,h=D,w=new Uint8Array(x.slice(0,z)),B=E,p=E.slice(0,E.length),b=I,M=v,L=e();return z=t,s=r,$=n,J=i,Y=u,Q=c,D=h,x=w,v=M,E=B,E.splice(0,E.length,...p),I=b,A=new DataView(x.buffer,x.byteOffset,x.byteLength),L}function Me(){x=null,Q=null,E=null}const Pe=new Array(147);for(let e=0;e<256;e++)Pe[e]=+("1e"+Math.floor(45.15-e*.30103));var xe=new ie({useRecords:!1});xe.unpack,xe.unpackMultiple,xe.unpack;let tr=new Float32Array(1);new Uint8Array(tr.buffer,0,4);let ge;try{ge=new TextEncoder}catch{}let _e,ut;const he=typeof Buffer<"u",ye=he?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,ct=he?Buffer:Uint8Array,lt=he?4294967296:2144337920;let a,fe,O,f=0,C,P=null,rr;const nr=21760,ir=/[\u0080-\uFFFF]/,te=Symbol("record-id");class Re extends ie{constructor(t){super(t),this.offset=0;let r,n,i,u,c=ct.prototype.utf8Write?function(o,y){return a.utf8Write(o,y,a.byteLength-y)}:ge&&ge.encodeInto?function(o,y){return ge.encodeInto(o,a.subarray(y)).written}:!1,h=this;t||(t={});let w=t&&t.sequential,B=t.structures||t.saveStructures,p=t.maxSharedStructures;if(p==null&&(p=B?32:0),p>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let b=t.maxOwnStructures;b==null&&(b=B?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let M=p>32||b+p>64,L=p+64,F=p+b+64;if(F>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let j=[],ae=0,we=0;this.pack=this.encode=function(o,y){if(a||(a=new ye(8192),O=a.dataView||(a.dataView=new DataView(a.buffer,0,8192)),f=0),C=a.length-10,C-f<2048?(a=new ye(a.length),O=a.dataView||(a.dataView=new DataView(a.buffer,0,a.length)),C=a.length-10,f=0):f=f+7&2147483640,r=f,y&cr&&(f+=y&255),u=h.structuredClone?new Map:null,h.bundleStrings&&typeof o!="string"?(P=[],P.size=1/0):P=null,i=h.structures,i){i.uninitialized&&(i=h._mergeStructures(h.getStructures()));let l=i.sharedLength||0;if(l>p)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let g=0;g<l;g++){let S=i[g];if(!S)continue;let U,m=i.transitions;for(let T=0,k=S.length;T<k;T++){let H=S[T];U=m[H],U||(U=m[H]=Object.create(null)),m=U}m[te]=g+64}this.lastNamedStructuresLength=l}w||(i.nextId=l+64)}n&&(n=!1);let d;try{h.randomAccessStructure&&o&&o.constructor&&o.constructor===Object?Br(o):_(o);let l=P;if(P&&gt(r,_,0),u&&u.idsToInsert){let g=u.idsToInsert.sort((T,k)=>T.offset>k.offset?1:-1),S=g.length,U=-1;for(;l&&S>0;){let T=g[--S].offset+r;T<l.stringsPosition+r&&U===-1&&(U=0),T>l.position+r?U>=0&&(U+=6):(U>=0&&(O.setUint32(l.position+r,O.getUint32(l.position+r)+U),U=-1),l=l.previous,S++)}U>=0&&l&&O.setUint32(l.position+r,O.getUint32(l.position+r)+U),f+=g.length*6,f>C&&K(f),h.offset=f;let m=fr(a.subarray(r,f),g);return u=null,m}return h.offset=f,y&or?(a.start=r,a.end=f,a):a.subarray(r,f)}catch(l){throw d=l,l}finally{if(i&&(Ut(),n&&h.saveStructures)){let l=i.sharedLength||0,g=a.subarray(r,f),S=ar(i,h);if(!d)return h.saveStructures(S,S.isCompatible)===!1?h.pack(o,y):(h.lastNamedStructuresLength=l,a.length>1073741824&&(a=null),g)}a.length>1073741824&&(a=null),y&ur&&(f=r)}};const Ut=()=>{we<10&&we++;let o=i.sharedLength||0;if(i.length>o&&!w&&(i.length=o),ae>1e4)i.transitions=null,we=0,ae=0,j.length>0&&(j=[]);else if(j.length>0&&!w){for(let y=0,d=j.length;y<d;y++)j[y][te]=0;j=[]}},Ve=o=>{var y=o.length;y<16?a[f++]=144|y:y<65536?(a[f++]=220,a[f++]=y>>8,a[f++]=y&255):(a[f++]=221,O.setUint32(f,y),f+=4);for(let d=0;d<y;d++)_(o[d])},_=o=>{f>C&&(a=K(f));var y=typeof o,d;if(y==="string"){let l=o.length;if(P&&l>=4&&l<4096){if((P.size+=l)>nr){let m,T=(P[0]?P[0].length*3+P[1].length:0)+10;f+T>C&&(a=K(f+T));let k;P.position?(k=P,a[f]=200,f+=3,a[f++]=98,m=f-r,f+=4,gt(r,_,0),O.setUint16(m+r-3,f-r-m)):(a[f++]=214,a[f++]=98,m=f-r,f+=4),P=["",""],P.previous=k,P.size=0,P.position=m}let U=ir.test(o);P[U?0:1]+=o,a[f++]=193,_(U?-l:l);return}let g;l<32?g=1:l<256?g=2:l<65536?g=3:g=5;let S=l*3;if(f+S>C&&(a=K(f+S)),l<64||!c){let U,m,T,k=f+g;for(U=0;U<l;U++)m=o.charCodeAt(U),m<128?a[k++]=m:m<2048?(a[k++]=m>>6|192,a[k++]=m&63|128):(m&64512)===55296&&((T=o.charCodeAt(U+1))&64512)===56320?(m=65536+((m&1023)<<10)+(T&1023),U++,a[k++]=m>>18|240,a[k++]=m>>12&63|128,a[k++]=m>>6&63|128,a[k++]=m&63|128):(a[k++]=m>>12|224,a[k++]=m>>6&63|128,a[k++]=m&63|128);d=k-f-g}else d=c(o,f+g);d<32?a[f++]=160|d:d<256?(g<2&&a.copyWithin(f+2,f+1,f+1+d),a[f++]=217,a[f++]=d):d<65536?(g<3&&a.copyWithin(f+3,f+2,f+2+d),a[f++]=218,a[f++]=d>>8,a[f++]=d&255):(g<5&&a.copyWithin(f+5,f+3,f+3+d),a[f++]=219,O.setUint32(f,d),f+=4),f+=d}else if(y==="number")if(o>>>0===o)o<32||o<128&&this.useRecords===!1||o<64&&!this.randomAccessStructure?a[f++]=o:o<256?(a[f++]=204,a[f++]=o):o<65536?(a[f++]=205,a[f++]=o>>8,a[f++]=o&255):(a[f++]=206,O.setUint32(f,o),f+=4);else if(o>>0===o)o>=-32?a[f++]=256+o:o>=-128?(a[f++]=208,a[f++]=o+256):o>=-32768?(a[f++]=209,O.setInt16(f,o),f+=2):(a[f++]=210,O.setInt32(f,o),f+=4);else{let l;if((l=this.useFloat32)>0&&o<4294967296&&o>=-2147483648){a[f++]=202,O.setFloat32(f,o);let g;if(l<4||(g=o*Pe[(a[f]&127)<<1|a[f+1]>>7])>>0===g){f+=4;return}else f--}a[f++]=203,O.setFloat64(f,o),f+=8}else if(y==="object"||y==="function")if(!o)a[f++]=192;else{if(u){let g=u.get(o);if(g){if(!g.id){let S=u.idsToInsert||(u.idsToInsert=[]);g.id=S.push(g)}a[f++]=214,a[f++]=112,O.setUint32(f,g.id),f+=4;return}else u.set(o,{offset:f-r})}let l=o.constructor;if(l===Object)pe(o);else if(l===Array)Ve(o);else if(l===Map)if(this.mapAsEmptyObject)a[f++]=128;else{d=o.size,d<16?a[f++]=128|d:d<65536?(a[f++]=222,a[f++]=d>>8,a[f++]=d&255):(a[f++]=223,O.setUint32(f,d),f+=4);for(let[g,S]of o)_(g),_(S)}else{for(let g=0,S=_e.length;g<S;g++){let U=ut[g];if(o instanceof U){let m=_e[g];if(m.write){m.type&&(a[f++]=212,a[f++]=m.type,a[f++]=0);let oe=m.write.call(this,o);oe===o?Array.isArray(o)?Ve(o):pe(o):_(oe);return}let T=a,k=O,H=f;a=null;let Z;try{Z=m.pack.call(this,o,oe=>(a=T,T=null,f+=oe,f>C&&K(f),{target:a,targetView:O,position:f-oe}),_)}finally{T&&(a=T,O=k,f=H,C=a.length-10)}Z&&(Z.length+f>C&&K(Z.length+f),f=sr(Z,a,f,m.type));return}}if(Array.isArray(o))Ve(o);else{if(o.toJSON){const g=o.toJSON();if(g!==o)return _(g)}if(y==="function")return _(this.writeFunction&&this.writeFunction(o));pe(o)}}}else if(y==="boolean")a[f++]=o?195:194;else if(y==="bigint"){if(o<BigInt(1)<<BigInt(63)&&o>=-(BigInt(1)<<BigInt(63)))a[f++]=211,O.setBigInt64(f,o);else if(o<BigInt(1)<<BigInt(64)&&o>0)a[f++]=207,O.setBigUint64(f,o);else if(this.largeBigIntToFloat)a[f++]=203,O.setFloat64(f,Number(o));else{if(this.largeBigIntToString)return _(o.toString());if(this.useBigIntExtension&&o<BigInt(2)**BigInt(1023)&&o>-(BigInt(2)**BigInt(1023))){a[f++]=199,f++,a[f++]=66;let l=[],g;do{let S=o&BigInt(255);g=(S&BigInt(128))===(o<BigInt(0)?BigInt(128):BigInt(0)),l.push(S),o>>=BigInt(8)}while(!((o===BigInt(0)||o===BigInt(-1))&&g));a[f-2]=l.length;for(let S=l.length;S>0;)a[f++]=Number(l[--S]);return}else throw new RangeError(o+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}f+=8}else if(y==="undefined")this.encodeUndefinedAsNil?a[f++]=192:(a[f++]=212,a[f++]=0,a[f++]=0);else throw new Error("Unknown type: "+y)},Tt=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?o=>{let y;if(this.skipValues){y=[];for(let g in o)(typeof o.hasOwnProperty!="function"||o.hasOwnProperty(g))&&!this.skipValues.includes(o[g])&&y.push(g)}else y=Object.keys(o);let d=y.length;d<16?a[f++]=128|d:d<65536?(a[f++]=222,a[f++]=d>>8,a[f++]=d&255):(a[f++]=223,O.setUint32(f,d),f+=4);let l;if(this.coercibleKeyAsNumber)for(let g=0;g<d;g++){l=y[g];let S=Number(l);_(isNaN(S)?l:S),_(o[l])}else for(let g=0;g<d;g++)_(l=y[g]),_(o[l])}:o=>{a[f++]=222;let y=f-r;f+=2;let d=0;for(let l in o)(typeof o.hasOwnProperty!="function"||o.hasOwnProperty(l))&&(_(l),_(o[l]),d++);if(d>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');a[y+++r]=d>>8,a[y+r]=d&255},kt=this.useRecords===!1?Tt:t.progressiveRecords&&!M?o=>{let y,d=i.transitions||(i.transitions=Object.create(null)),l=f++-r,g;for(let S in o)if(typeof o.hasOwnProperty!="function"||o.hasOwnProperty(S)){if(y=d[S],y)d=y;else{let U=Object.keys(o),m=d;d=i.transitions;let T=0;for(let k=0,H=U.length;k<H;k++){let Z=U[k];y=d[Z],y||(y=d[Z]=Object.create(null),T++),d=y}l+r+1==f?(f--,je(d,U,T)):It(d,U,l,T),g=!0,d=m[S]}_(o[S])}if(!g){let S=d[te];S?a[l+r]=S:It(d,Object.keys(o),l,0)}}:o=>{let y,d=i.transitions||(i.transitions=Object.create(null)),l=0;for(let S in o)(typeof o.hasOwnProperty!="function"||o.hasOwnProperty(S))&&(y=d[S],y||(y=d[S]=Object.create(null),l++),d=y);let g=d[te];g?g>=96&&M?(a[f++]=((g-=96)&31)+96,a[f++]=g>>5):a[f++]=g:je(d,d.__keys__||Object.keys(o),l);for(let S in o)(typeof o.hasOwnProperty!="function"||o.hasOwnProperty(S))&&_(o[S])},Ot=typeof this.useRecords=="function"&&this.useRecords,pe=Ot?o=>{Ot(o)?kt(o):Tt(o)}:kt,K=o=>{let y;if(o>16777216){if(o-r>lt)throw new Error("Packed buffer would be larger than maximum buffer size");y=Math.min(lt,Math.round(Math.max((o-r)*(o>67108864?1.25:2),4194304)/4096)*4096)}else y=(Math.max(o-r<<2,a.length-1)>>12)+1<<12;let d=new ye(y);return O=d.dataView||(d.dataView=new DataView(d.buffer,0,y)),o=Math.min(o,a.length),a.copy?a.copy(d,0,r,o):d.set(a.slice(r,o)),f-=r,r=0,C=d.length-10,a=d},je=(o,y,d)=>{let l=i.nextId;l||(l=64),l<L&&this.shouldShareStructure&&!this.shouldShareStructure(y)?(l=i.nextOwnId,l<F||(l=L),i.nextOwnId=l+1):(l>=F&&(l=L),i.nextId=l+1);let g=y.highByte=l>=96&&M?l-96>>5:-1;o[te]=l,o.__keys__=y,i[l-64]=y,l<L?(y.isShared=!0,i.sharedLength=l-63,n=!0,g>=0?(a[f++]=(l&31)+96,a[f++]=g):a[f++]=l):(g>=0?(a[f++]=213,a[f++]=114,a[f++]=(l&31)+96,a[f++]=g):(a[f++]=212,a[f++]=114,a[f++]=l),d&&(ae+=we*d),j.length>=b&&(j.shift()[te]=0),j.push(o),_(y))},It=(o,y,d,l)=>{let g=a,S=f,U=C,m=r;a=fe,f=0,r=0,a||(fe=a=new ye(8192)),C=a.length-10,je(o,y,l),fe=a;let T=f;if(a=g,f=S,C=U,r=m,T>1){let k=f+T-1;k>C&&K(k);let H=d+r;a.copyWithin(H+T,H+1,f),a.set(fe.slice(0,T),H),f=k}else a[d+r]=fe[0]},Br=o=>{let y=rr(o,a,r,f,i,K,(d,l,g)=>{if(g)return n=!0;f=l;let S=a;return _(d),Ut(),S!==a?{position:f,targetView:O,target:a}:f},this);if(y===0)return pe(o);f=y}}useBuffer(t){a=t,a.dataView||(a.dataView=new DataView(a.buffer,a.byteOffset,a.byteLength)),f=0}set position(t){f=t}get position(){return f}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ut=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ye],_e=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:u,position:c}=t(6);i[c++]=214,i[c++]=255,u.setUint32(c,n)}else if(n>0&&n<4294967296){let{target:i,targetView:u,position:c}=t(10);i[c++]=215,i[c++]=255,u.setUint32(c,e.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),u.setUint32(c+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:i,targetView:u,position:c}=t(3);i[c++]=212,i[c++]=255,i[c++]=255}else{let{target:i,targetView:u,position:c}=t(15);i[c++]=199,i[c++]=12,i[c++]=255,u.setUint32(c,e.getMilliseconds()*1e6),u.setBigInt64(c+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){if(this.setAsEmptyObject)return t(0),r({});let n=Array.from(e),{target:i,position:u}=t(this.moreTypes?3:0);this.moreTypes&&(i[u++]=212,i[u++]=115,i[u++]=0),r(n)}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([e.name,e.message,e.cause])}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([e.source,e.flags])}},{pack(e,t){this.moreTypes?dt(e,16,t):xt(he?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==ct&&this.moreTypes?dt(e,at.indexOf(r.name),t):xt(e,t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];function dt(e,t,r,n){let i=e.byteLength;if(i+1<256){var{target:u,position:c}=r(4+i);u[c++]=199,u[c++]=i+1}else if(i+1<65536){var{target:u,position:c}=r(5+i);u[c++]=200,u[c++]=i+1>>8,u[c++]=i+1&255}else{var{target:u,position:c,targetView:h}=r(7+i);u[c++]=201,h.setUint32(c,i+1),c+=4}u[c++]=116,u[c++]=t,e.buffer||(e=new Uint8Array(e)),u.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),c)}function xt(e,t){let r=e.byteLength;var n,i;if(r<256){var{target:n,position:i}=t(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=t(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:u}=t(r+5);n[i++]=198,u.setUint32(i,r),i+=4}n.set(e,i)}function sr(e,t,r,n){let i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=i&255):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=i&255)}return t[r++]=n,t.set(e,r),r+=i,r}function fr(e,t){let r,n=t.length*6,i=e.length-n;for(;r=t.pop();){let u=r.offset,c=r.id;e.copyWithin(u+n,u,i),n-=6;let h=u+n;e[h++]=214,e[h++]=105,e[h++]=c>>24,e[h++]=c>>16&255,e[h++]=c>>8&255,e[h++]=c&255,i=u}return e}function gt(e,t,r){if(P.length>0){O.setUint32(P.position+e,f+r-P.position-e),P.stringsPosition=f-e;let n=P;P=null,t(n[0]),t(n[1])}}function ar(e,t){return e.isCompatible=r=>{let n=!r||(t.lastNamedStructuresLength||0)===r.length;return n||t._mergeStructures(r),n},e}let ht=new Re({useRecords:!1});ht.pack,ht.pack;const or=512,ur=1024,cr=2048,lr=e=>new Re({structuredClone:!0}).unpack(new Uint8Array(e));function dr(e){return Ee(e)?gr(e):xr(e)}async function xr(e){const t=await ee(e);return Ae(t)}function gr(e){const t=Be(e);return Ae(t)}const yt=(e,t="application/octet-stream")=>e instanceof Blob?e:e instanceof ArrayBuffer?new Blob([e],{type:t}):typeof e=="string"?new Blob([e],{type:t}):ArrayBuffer.isView(e)?new Blob([e],{type:t}):Array.isArray(e)?new Blob([me(e)],{type:t}):new Blob([]),G={toMsgPack:e=>{const t=new Re({structuredClone:!0});return new Uint8Array(t.encode(e))},msgPackToObject:lr,typeOfBytes:e=>{if(e instanceof Blob)return"Blob";if(e instanceof ArrayBuffer)return"ArrayBuffer";if(typeof e=="string")return"string";if(ArrayBuffer.isView(e))return"ArrayBufferView";if(Array.isArray(e))return"Array"},toDataUrl:async e=>{const t=yt(e),r=new FileReader;return new Promise((n,i)=>{const u=c=>typeof c=="string"?n(c):(console.log({bytes:e}),i("Unable to convert to data URL"));r.onload=function(c){u(c.target?.result)},r.readAsDataURL(t)})},dataUrlToBlob:zt,lengthOf:Qt,isByteLike:Ht,isImmediateByteLike:Ee,hashOf:ce,immediateHashOf:Jt,addressStringOf:le,toArrayBuffer:ee,immediateToArrayBuffer:Be,toBlob:yt,toText:He,toBase64:dr,encodeAsString:Je,test:Ct,assignMediaTypeToBlob:$t,utf8ToUint8Array:e=>new TextEncoder().encode(e),base64ToArrayBuffer:Ft,arrayBufferToHex:Nt,arrayBufferToUtf8:qt,arrayBufferToBase64:Ae,ALL_ALGORITHMS:Se,ALGORITHM_BYTE_LENGTHS:Fe},hr=e=>typeof e=="function",wt=e=>e==null||Number.isNaN(e),pt=e=>!wt(e),yr=e=>hr(e)?e():e,wr={isDefined:pt,isUndefined:wt,safe:(e,t={})=>{const{quiet:r=!1,def:n=void 0,onError:i}=t;try{return e()}catch(u){return r||(console.error(u),pt(i)&&console.log(yr(i))),n}}},{isDefined:Le,isUndefined:pr,safe:St}=wr,De=e=>{const{message:t,stack:r,extra:n,cause:i}=e,u=i?`
Caused by: ${De(i)}`:"",c=n?`
Extra: ${JSON.stringify(n,void 0,2)}`:"";return[t,r].filter(Le).join(`
`)+c+u},bt=e=>typeof e=="string"?e:e instanceof Response?`${e.url} ${e.status} ${e.statusText}`:typeof e=="object"&&e!==null&&"message"in e?De(e):St(()=>JSON.stringify(e,void 0,2))??"",Sr=async e=>{if(typeof e=="string")return e;if(e instanceof Response){const t=await e.text();return`${e.url} ${e.status} ${e.statusText} ${t}`}return typeof e=="object"&&e!==null&&"message"in e?De(e):St(()=>JSON.stringify(e,void 0,2))??""},mt=({error:e,extra:t,stack:r})=>{if(e instanceof Error){const n=Le(e.cause)?mt({error:e.cause}):void 0;return{message:e.message,stack:e.stack??r,extra:t,cause:n}}return{message:bt(e),stack:r,extra:t}},br={errorToErrorDetail:mt,errorToText:bt,errorToTextAsync:Sr},At=async({channel:e,subject:t,connectionListener:r,options:n={}})=>{const{log:i=()=>{},signal:u}=n;i("connectConnectionListenerToSubject: subject: ",t);for await(const c of e.listenOn(t,{callback:async h=>{const w=G.msgPackToObject(h),{data:B,meta:p}=w;if($e(w))throw console.error("Error in message: ",w),new Error(`connectConnectionListenerToSubject: Unexpected error in request message: ${w?.data?.message}`);try{const b=await r(B,{headers:p?.headers,signal:u});return G.toMsgPack({data:b})}catch(b){const M=br.errorToErrorDetail({error:b});return G.toMsgPack({data:M,meta:{hasError:!0,code:500,status:M.message}})}}}));},mr=async({channel:e,subscribers:t={},options:r={}})=>{const{log:n=()=>{},defaultTimeoutMs:i=60*1e3,signal:u}=r,c=Object.entries(t);n("connect: subscribers: ",c);for(const[h,w]of c)pr(w)||At({channel:e,subject:h,connectionListener:w,options:r});return{requestMany:async(h,w,B={})=>{const{timeoutMs:p=60*1e3,headers:b,callback:M}=B,L=G.toMsgPack({data:w,meta:{headers:b}}),F=await e.requestMany(h,L,{timeoutMs:p});for await(const j of F){if(u?.aborted)return;const ae=G.msgPackToObject(j);await M?.(ae)}},request:async(h,w,B={})=>{const{timeoutMs:p=i,headers:b}=B,M=G.toMsgPack({data:w,meta:{headers:b}}),L=await e.request(h,M,{timeoutMs:p});return G.msgPackToObject(L)},publish:async(h,w,B={})=>{const{headers:p}=B,b=G.toMsgPack({data:w,meta:{headers:p}});return e.postOn(h,b)},subscribe:async(h,w,B={})=>At({channel:e,subject:h,connectionListener:w,options:B})}},Bt=({posterProducer:e,listenerProducer:t})=>{const r={postOn:(n,i,u={})=>{const{signal:c,reply:h}=u;e(c)({subject:n,data:i,reply:h})},listenOn:function(n,i={}){const{signal:u,once:c,callback:h}=i,w=new AbortController;if(u?.aborted)throw new Error(`listenOn: Signal is already aborted for ${n}`);u?.addEventListener("abort",()=>{w.abort()});const B=t(w.signal)(async p=>{if(typeof n=="string"?p.subject===n:n.test(p.subject)){c&&w.abort();const b=await h?.(p.data,{finished:p.finished??!1});if(p.reply&&b&&(Et(b)?(async()=>{for await(const M of b)e(w.signal)({subject:p.reply,data:M});e(w.signal)({subject:p.reply,data:void 0,finished:!0})})():e(w.signal)({subject:p.reply,data:b,finished:!0})),b&&!Et(b))return{...p,data:b}}return p});return async function*(){for await(const p of B)yield p.data}()},request:async(n,i,u={})=>{const{signal:c,timeoutMs:h}=u,w=`response-${Date.now()}-${crypto.randomUUID()}`;return new Promise((B,p)=>{c?.aborted&&p(new Error(`request: Signal is already aborted for ${n}`)),c?.addEventListener("abort",()=>{p(new Error("Request aborted"))});let b;h&&(b=setTimeout(()=>{p(new Error(`request: Request timed out after ${h}ms for ${n}`))},h)),r.listenOn(w,{callback:M=>{clearTimeout(b),B(M)},signal:c,once:!0}),r.postOn(n,i,{reply:w,signal:c})})},requestMany:async(n,i,u={})=>{const{signal:c,timeoutMs:h,callback:w}=u,B=`response-${Date.now()}-${crypto.randomUUID()}`;return new Promise((p,b)=>{c?.aborted&&b(new Error(`requestMany: Signal is already aborted for ${n}`)),c?.addEventListener("abort",()=>{b(new Error("Request aborted"))});let M;h&&(M=setTimeout(()=>{b(new Error(`requestMany: Request timed out after ${h}ms for ${n}`))},h));const L=r.listenOn(B,{callback:(F,j)=>{if(F!==void 0&&w?.(F),j.finished)return clearTimeout(M),p(L)},signal:c});return r.postOn(n,i,{reply:B,signal:c}),L})}};return r};function Et(e){return e!=null&&typeof e[Symbol.asyncIterator]=="function"}const Ar=(e,t="channel_message")=>Bt({posterProducer:r=>n=>{r?.aborted||e.emit(t,n)},listenerProducer:r=>n=>{const i=[],u={resolve:void 0},c=async h=>{if(r?.aborted)return;const w=await n?.(h),B=Le(w)?w:h;i.push(B),u.resolve?.()};return r?.addEventListener("abort",()=>{e.off(t,c)}),e.on(t,c),{[Symbol.asyncIterator]:async function*(){for(;!r?.aborted;)i.length>0?yield i.shift():await new Promise(h=>{u.resolve=h})}}}});N.Channel=Bt,N.EmitterChannel=Ar,N.MessageBus=mr,N.isError=Ne,N.isErrorMsg=$e,N.isMsg=qe,N.isValue=Ce,N.isValueOrError=Mt,N.parseSubject=re,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
